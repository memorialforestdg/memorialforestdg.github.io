---
import Flourish from '../components/Flourish.astro'
import Gallery from '../components/Gallery.astro'
import BaseLayout from './BaseLayout.astro'
import {type ImageMetadata} from 'astro'
import {type DataEntryMap} from 'astro:content'
interface Props {
  frontmatter: {
    pageTitle: string
    bannerImage?: string
    bannerHeight?: number
    bannerAlt?: string
    flourishClasses?: Array<string>
    collectionId?: keyof DataEntryMap
    albumId?: string
  }
}

const {
  pageTitle,
  bannerImage = '',
  bannerHeight,
  bannerAlt,
  flourishClasses,
  collectionId,
  albumId
} = Astro.props.frontmatter

const images = import.meta.glob<{default: ImageMetadata}>(
  '../images/**/*.{png,PNG,jpg,JPG,jpeg,svg,webp,avif}'
)
const banner = images[bannerImage] ? await images[bannerImage]() : (null as any)
const BannerImage = banner?.default as ImageMetadata
---

<BaseLayout
  pageTitle={pageTitle}
  bannerImage={BannerImage}
  bannerHeight={bannerHeight}
  bannerAlt={bannerAlt}
>
  <main id="main">
    <div class="location__page container full-width">
      <div class="markdown-content location__wrap measure-3 pt-4">
        <Flourish classes={flourishClasses}>
          <slot />
          <hr />
        </Flourish>
        <!-- add a gallery if collectionId and albumId are provided -->
        {
          collectionId && albumId ? (
            <Gallery collectionId={collectionId} albumId={albumId} />
          ) : null
        }
      </div>
    </div>
  </main>
</BaseLayout>
